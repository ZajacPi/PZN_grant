#include<mpu6050.h>
#include<main.h>
extern I2C_HandleTypeDef hi2c1;

void mpu6050_init(){
	  printf(".................................................\n");
	printf("Checking connection...\n");
	  HAL_StatusTypeDef ret = HAL_I2C_IsDeviceReady(&hi2c1, MPU6050_ADDR, 1, 100);
	  if (ret == HAL_OK){
		  printf("Device ready!\n");
	  }
	  else{
		  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
		  printf("Device not detected. Check connection.\n");
		  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
	  }
	  uint8_t temp_data = 0b00001000; // set to
	  ret = HAL_I2C_Mem_Write(&hi2c1, MPU6050_ADDR, CONFIG_GYRO, 1, &temp_data, 1, 100);
	  if (ret == HAL_OK){
		  printf("Gyroscope configured!\n");
	  }
	  else{
		  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
		  printf("Cannot configure gyroscope.\n");
		  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
	  }
	   temp_data = 0b00001000; // set to +- 4g
		  ret = HAL_I2C_Mem_Write(&hi2c1, MPU6050_ADDR, CONFIG_ACC, 1, &temp_data, 1, 100);
		  if (ret == HAL_OK){
			  printf("Accelerometer configured!\n");
		  }
		  else{
			  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
			  printf("Cannot configure accelerometer.\n");
			  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
		  }

	  temp_data = 0b00001000; // set to +- 4g
		  ret = HAL_I2C_Mem_Write(&hi2c1, MPU6050_ADDR, PWR_MANAGEMENT, 1, &temp_data, 1, 100);
		  if (ret == HAL_OK){
			  printf("Power management successfull, exit sleep mode!\n");
		  }
		  else{
			  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
			  printf("Cannot configure powermanagement.\n");
			  printf("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n");
		  }
}
